<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to preprocess • preprocess</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to preprocess">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">preprocess</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pipeline-guide.html">Sepages pipeline guide</a></li>
    <li><a class="dropdown-item" href="../articles/preprocess-intro.html">Introduction to preprocess</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to preprocess</h1>
            
      

      <div class="d-none name"><code>preprocess-intro.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjrolland.github.io/preprocess">preprocess</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates the use of simulated datasets to
illustrate the application of the <code>fill_in</code> and
<code>standardise</code> functions for preprocessing environmental
exposure data.</p>
<p>⚠️ <strong>Important</strong>: The <code>fill_in</code> function
assumes that the variable to impute is normally distributed. It is the
user’s responsibility to apply the appropriate transformation (e.g.,
log-transformation) to ensure normality prior to using this function.
The same transformation must be applied to the Limit of Detection (LOD)
to ensure consistency.</p>
<p>Specifically, it covers how to:</p>
<ul>
<li>Handle values below the Limit of Detection (LOD) using the method
proposed by Helsel (1990). This approach accommodates one or multiple
exposure components, each with potentially different LODs.</li>
<li>Standardize exposure data by adjusting for protocol variables
selected from a list of candidates, while also accounting for additional
covariates, following the method of Mortamais et al. (2012).</li>
</ul>
</div>
<div class="section level2">
<h2 id="the-simulated-data">The Simulated Data<a class="anchor" aria-label="anchor" href="#the-simulated-data"></a>
</h2>
<p>The datasets used in this example were designed to resemble
real-world environmental exposure data. They simulate common scenarios
where LOD handling and standardization are necessary.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load simulated data </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dt_exp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dt_lod"</span><span class="op">)</span></span></code></pre></div>
<p>The example data (<code>dt_exp</code>) consists of the following
variables:</p>
<ul>
<li>4 lognormally distributed exposures <code>exp1</code>,
<code>exp2</code>, <code>exp3</code> and <code>exp4</code>, left
censored (LOD), with missing data. Data below LOD is reported as
“&lt;LOD”.</li>
<li>
<code>batch</code>, batch effect which is TRUE for <code>exp1</code>
and <code>exp4</code>
</li>
<li>
<code>prot1</code> continuous protocol variable associated with
<code>exp2</code>
</li>
<li>
<code>prot2</code> continuous protocol variable associated with none
of the exposures</li>
<li>
<code>season</code>, season effect which is TRUE for
<code>exp4</code>, in addition to the batch effect</li>
<li>
<code>cov1</code>, additional covariate to be included in
standardisation models</li>
</ul>
<p>Examples of candidate protocol variables include: sample
transportation time, sample defreeze time prior to measurement. Examples
of additional covariates to be included in the standardisation model
include: age or breastfeeding duration.</p>
<p>The data is in a wide format (one column per exposure), which is the
usual format such data is provided by analytical laboratories.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dt_exp</span><span class="op">)</span></span>
<span><span class="co">#&gt;     id batch             exp1             exp2              exp3       prot1</span></span>
<span><span class="co">#&gt; 1  id8     1 1.22925099690535 2.88779888466437              &lt;LOD -0.00954975</span></span>
<span><span class="co">#&gt; 2 id14     1 4.17231182471364  3.9394983990565              &lt;LOD -0.38237917</span></span>
<span><span class="co">#&gt; 3 id16     1 3.55763803500625 1.75607103905869 0.561280432909913 -0.59325353</span></span>
<span><span class="co">#&gt; 4 id17     1 2.25789439366093             &lt;LOD              &lt;LOD -0.19531902</span></span>
<span><span class="co">#&gt; 5 id22     1 6.92484889235359 1.46692222224359 0.853212096159328 -0.06349861</span></span>
<span><span class="co">#&gt; 6 id25     1 4.96218477666339 1.39213028969762              &lt;LOD  0.36055996</span></span>
<span><span class="co">#&gt;      prot2 season             exp4         cov1</span></span>
<span><span class="co">#&gt; 1 31.35448 Autumn 3.22925099690535 -0.122238985</span></span>
<span><span class="co">#&gt; 2 47.39001 Summer 3.17231182471364 -0.042519367</span></span>
<span><span class="co">#&gt; 3 43.81518 Summer 2.55763803500625  0.005900652</span></span>
<span><span class="co">#&gt; 4 41.45147 Spring 5.25789439366093  0.330839677</span></span>
<span><span class="co">#&gt; 5 68.25540 Spring 9.92484889235359  0.034422787</span></span>
<span><span class="co">#&gt; 6 43.87650 Summer 3.96218477666339  0.241904949</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dt_lod</span><span class="op">)</span></span>
<span><span class="co">#&gt;    exp lod</span></span>
<span><span class="co">#&gt; 1 exp1 1.1</span></span>
<span><span class="co">#&gt; 2 exp2 1.1</span></span>
<span><span class="co">#&gt; 3 exp3 0.4</span></span>
<span><span class="co">#&gt; 4 exp4 1.7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-data">Prepare data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<p>Data first needs to be converted to tidy format (one row per id and
per compound, one column per variable) and LOD needs to be added in new
column:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert exposure to long format and add lod</span></span>
<span><span class="va">dt_exp_long</span> <span class="op">&lt;-</span> <span class="va">dt_exp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"exp"</span><span class="op">)</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"val"</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"exp"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dt_lod</span>, by <span class="op">=</span> <span class="st">"exp"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    val_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">val</span> <span class="op">==</span> <span class="st">"&lt;LOD"</span>, <span class="va">lod</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dt_exp_long</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">#&gt;   id    batch    prot1 prot2 season    cov1 exp   val                lod val_num</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> id8       1 -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">55</span>  31.4 Autumn -<span style="color: #BB0000;">0.122</span>  exp1  1.22925099690535   1.1    1.23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> id8       1 -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">55</span>  31.4 Autumn -<span style="color: #BB0000;">0.122</span>  exp2  2.88779888466437   1.1    2.89</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> id8       1 -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">55</span>  31.4 Autumn -<span style="color: #BB0000;">0.122</span>  exp3  &lt;LOD               0.4    0.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> id8       1 -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">55</span>  31.4 Autumn -<span style="color: #BB0000;">0.122</span>  exp4  3.22925099690535   1.7    3.23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> id14      1 -<span style="color: #BB0000;">0.382</span>    47.4 Summer -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">5</span> exp1  4.17231182471364   1.1    4.17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> id14      1 -<span style="color: #BB0000;">0.382</span>    47.4 Summer -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">5</span> exp2  3.9394983990565    1.1    3.94</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-description">Data description<a class="anchor" aria-label="anchor" href="#data-description"></a>
</h2>
<p>It is important to describe data prior to pre-processing.</p>
<p>Detection rates and basic statistics:</p>
<div id="mwlefoodfi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mwlefoodfi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mwlefoodfi thead, #mwlefoodfi tbody, #mwlefoodfi tfoot, #mwlefoodfi tr, #mwlefoodfi td, #mwlefoodfi th {
  border-style: none;
}

#mwlefoodfi p {
  margin: 0;
  padding: 0;
}

#mwlefoodfi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mwlefoodfi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mwlefoodfi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mwlefoodfi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mwlefoodfi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mwlefoodfi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mwlefoodfi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mwlefoodfi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mwlefoodfi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mwlefoodfi .gt_spanner_row {
  border-bottom-style: hidden;
}

#mwlefoodfi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mwlefoodfi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mwlefoodfi .gt_from_md > :first-child {
  margin-top: 0;
}

#mwlefoodfi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mwlefoodfi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mwlefoodfi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mwlefoodfi .gt_row_group_first td {
  border-top-width: 2px;
}

#mwlefoodfi .gt_row_group_first th {
  border-top-width: 2px;
}

#mwlefoodfi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mwlefoodfi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mwlefoodfi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mwlefoodfi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mwlefoodfi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mwlefoodfi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mwlefoodfi .gt_left {
  text-align: left;
}

#mwlefoodfi .gt_center {
  text-align: center;
}

#mwlefoodfi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mwlefoodfi .gt_font_normal {
  font-weight: normal;
}

#mwlefoodfi .gt_font_bold {
  font-weight: bold;
}

#mwlefoodfi .gt_font_italic {
  font-style: italic;
}

#mwlefoodfi .gt_super {
  font-size: 65%;
}

#mwlefoodfi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mwlefoodfi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mwlefoodfi .gt_indent_1 {
  text-indent: 5px;
}

#mwlefoodfi .gt_indent_2 {
  text-indent: 10px;
}

#mwlefoodfi .gt_indent_3 {
  text-indent: 15px;
}

#mwlefoodfi .gt_indent_4 {
  text-indent: 20px;
}

#mwlefoodfi .gt_indent_5 {
  text-indent: 25px;
}

#mwlefoodfi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mwlefoodfi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Description of raw exposure data</caption>
  <thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="exp">Exposure</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="below_lod">% &lt; LOD</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="p5">p5</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="p50">Median</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="p95">p95</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="exp" class="gt_row gt_left">exp1</td>
<td headers="below_lod" class="gt_row gt_right">5%</td>
<td headers="p5" class="gt_row gt_left">&lt;LOD</td>
<td headers="p50" class="gt_row gt_right">3.55</td>
<td headers="p95" class="gt_row gt_right">7.39</td>
</tr>
<tr>
<td headers="exp" class="gt_row gt_left">exp2</td>
<td headers="below_lod" class="gt_row gt_right">15%</td>
<td headers="p5" class="gt_row gt_left">&lt;LOD</td>
<td headers="p50" class="gt_row gt_right">2</td>
<td headers="p95" class="gt_row gt_right">4.58</td>
</tr>
<tr>
<td headers="exp" class="gt_row gt_left">exp3</td>
<td headers="below_lod" class="gt_row gt_right">31%</td>
<td headers="p5" class="gt_row gt_left">&lt;LOD</td>
<td headers="p50" class="gt_row gt_right">0.5</td>
<td headers="p95" class="gt_row gt_right">1.16</td>
</tr>
<tr>
<td headers="exp" class="gt_row gt_left">exp4</td>
<td headers="below_lod" class="gt_row gt_right">5%</td>
<td headers="p5" class="gt_row gt_left">1.74</td>
<td headers="p50" class="gt_row gt_right">5.44</td>
<td headers="p95" class="gt_row gt_right">9.73</td>
</tr>
</tbody>
</table>
</div>
<p>Exposure level distribution:</p>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>=&gt; We observe different rates of data below LOD. Based on this,
exposures that are considered having too high rates of data &lt; LOD
need to be excluded from the imputation-standardisation process. In this
example <code>exp3</code> will be removed from any further processing
and will be categorised.</p>
</div>
<div class="section level2">
<h2 id="step-1-fill-in-data-below-lod">Step 1: Fill in data below LOD<a class="anchor" aria-label="anchor" href="#step-1-fill-in-data-below-lod"></a>
</h2>
<p>The <code>fill_in</code> function is written to be used on tidy data
(one row per id and per exposure). It is important to specify the
<code>.by</code> argument of the <code>mutate</code> call in order to
separately impute data below LOD for each group. This is important
because this step requires computing exposure specific distribution
parameters, and LOD can also vary from one exposure to another. In this
simple example the only grouping variable is the exposure, but there
could be more groups on which we would like to apply the fill-in
procedure separately like exposure <em>and</em> sample period, in which
case the <code>.by</code> argument of the <code>mutate</code> call would
be modified to <code>.by = c(exp, period)</code>.</p>
<p><strong>Important</strong>: The <code>fill_in</code> function uses
the method of Helsel (1990), which assumes that the variable to be
imputed follows a <strong>normal distribution</strong>. In environmental
epidemiology, exposure variables are often log-normally distributed.
Therefore, the user <strong>must apply a log-transformation</strong> (or
another appropriate transformation) to the variable
<strong>before</strong> calling <code>fill_in</code>, and <strong>must
apply the same transformation to the LOD</strong>.</p>
<p>The function does not perform any transformation by itself and relies
on the user to ensure distributional assumptions are met.</p>
<p>Fill in is done like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Impute data below LOD </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">113</span><span class="op">)</span></span>
<span><span class="va">dt_imp</span> <span class="op">&lt;-</span> <span class="va">dt_exp_long</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">exp</span> <span class="op">!=</span> <span class="st">"exp3"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    log10_val_i <span class="op">=</span> <span class="fu"><a href="../reference/fill_in.html">fill_in</a></span><span class="op">(</span></span>
<span>      var_to_fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">val_num</span><span class="op">)</span>, <span class="co"># variable to be filled in, needs to be normal</span></span>
<span>      lod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">lod</span><span class="op">)</span>              <span class="co"># variable containing LOD, needs to be same unit as variable to fill</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">exp</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Important</strong>: set a seed prior to fill-in for
reproducibility.</p>
<p>Then systematically visualise the imputations to make sure everything
went as expected:</p>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>We see that imputed data is below LOD, and seem to have been drawn
from the correct distribution.</p>
</div>
<div class="section level2">
<h2 id="step-2-standardise-data-on-protocol-variables">Step 2: Standardise data on protocol variables<a class="anchor" aria-label="anchor" href="#step-2-standardise-data-on-protocol-variables"></a>
</h2>
<p>Next we want to standardise the filled-in values on protocol
variables <code>batch</code>, <code>prot1</code> and <code>prot2</code>,
while taking into account the covariates <code>season</code> and
<code>cov1</code>.</p>
<p>We start by describing the data.</p>
<p>We can observe the batch effect for <code>exp1</code> and
<code>exp4</code>:</p>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<p>And we can observe the effect of season for <code>exp4</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dt_imp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">log10_val_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">exp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">see</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/see/reference/theme_lucid.html" class="external-link">theme_lucid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Imputed exposure level by season, for each exposure prior to standardising"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<p>And finally we observe an unequal distribution of season by
batch:</p>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-15-1.png" width="384"></p>
<p>This justifies the inclusion of <code>season</code> as a covariate in
the standardisation models, in order to differentiate the effect of
<code>batch</code> from the effect of <code>season</code>, because we
want to standardise for <code>batch</code> but not for
<code>season</code>.</p>
<p>We can also observe the association between <code>exp2</code> and
<code>prot1</code>:</p>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>The goal of the standardisation process is to detect among all the
protocol variables (<code>batch</code>, <code>prot1</code> and
<code>prot2</code>) which are associated with which exposure, and
standardise each exposures for the specific protocol to which it is
associated.</p>
<p>The first step of the standardisation process is to define potential
protocol variables that might be associated with the variable to
standardise and the extra covariates to be included in the model:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lst_prot_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"batch"</span>, <span class="st">"prot1"</span>, <span class="st">"prot2"</span><span class="op">)</span> </span>
<span><span class="va">lst_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"cov1"</span><span class="op">)</span></span></code></pre></div>
<p>Then define which are the reference values for the categorical
variables (e.g. if the reference value for batch is <em>batch 2</em>,
all batches will be “aligned” with batch 2):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set categorical variable reference values for categorical data</span></span>
<span><span class="va">dt_imp</span> <span class="op">&lt;-</span> <span class="va">dt_imp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    batch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"2"</span><span class="op">)</span>,</span>
<span>    season <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span>, ref <span class="op">=</span> <span class="st">"Spring"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Reference value for continuous protocol variables is the median <span class="citation">[@mortamais_correcting_2012]</span>.</p>
<p>Once the protocol variables and the covariates have been listed and
the reference values have been set, we can apply the standardisation
function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standardise </span></span>
<span><span class="va">dt_std</span> <span class="op">&lt;-</span> <span class="va">dt_imp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    log10_val_i_std <span class="op">=</span> <span class="fu"><a href="../reference/standardise.html">standardise</a></span><span class="op">(</span></span>
<span>      var_to_std <span class="op">=</span> <span class="st">"log10_val_i"</span>,               <span class="co"># variable to be standardised</span></span>
<span>      protocol_vars <span class="op">=</span> <span class="va">lst_prot_vars</span>,            <span class="co"># list of candidate protocol variables</span></span>
<span>      covariates <span class="op">=</span> <span class="va">lst_cov</span>,                     <span class="co"># optional list of covariates, defaults to NULL</span></span>
<span>      folder <span class="op">=</span> <span class="st">"standardisation_outputs"</span>        <span class="co"># folder where outputs are saved</span></span>
<span>    <span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">exp</span>                                   <span class="co"># grouping variable</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>It is crucial to look at the standardisation process outputs and the
data posterior to the standardisation step to make sure what was done
matches what was expected.</p>
<p>All outputs are saved in the folder defined in the <code>path</code>
argument.</p>
<p>If you want to inspect model diagnostics (linearity, residuals,
homoscedasticity, etc.), you can enable the optional argument
<code>export_check_model = TRUE</code> in the <code><a href="../reference/standardise.html">standardise()</a></code>
function. This will save model diagnostic plots produced by
<code><a href="https://easystats.github.io/performance/reference/check_model.html" class="external-link">performance::check_model()</a></code> in the same folder as the other
outputs. This can help verify that linear model assumptions hold for the
correction models.</p>
<p>We can first have a look at the associated protocol variables, that
were used for the correction:</p>
<div id="psxunkjlhk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#psxunkjlhk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#psxunkjlhk thead, #psxunkjlhk tbody, #psxunkjlhk tfoot, #psxunkjlhk tr, #psxunkjlhk td, #psxunkjlhk th {
  border-style: none;
}

#psxunkjlhk p {
  margin: 0;
  padding: 0;
}

#psxunkjlhk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#psxunkjlhk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#psxunkjlhk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#psxunkjlhk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#psxunkjlhk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#psxunkjlhk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#psxunkjlhk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#psxunkjlhk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#psxunkjlhk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#psxunkjlhk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#psxunkjlhk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#psxunkjlhk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#psxunkjlhk .gt_spanner_row {
  border-bottom-style: hidden;
}

#psxunkjlhk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#psxunkjlhk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#psxunkjlhk .gt_from_md > :first-child {
  margin-top: 0;
}

#psxunkjlhk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#psxunkjlhk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#psxunkjlhk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#psxunkjlhk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#psxunkjlhk .gt_row_group_first td {
  border-top-width: 2px;
}

#psxunkjlhk .gt_row_group_first th {
  border-top-width: 2px;
}

#psxunkjlhk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#psxunkjlhk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#psxunkjlhk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#psxunkjlhk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#psxunkjlhk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#psxunkjlhk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#psxunkjlhk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#psxunkjlhk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#psxunkjlhk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#psxunkjlhk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#psxunkjlhk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#psxunkjlhk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#psxunkjlhk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#psxunkjlhk .gt_left {
  text-align: left;
}

#psxunkjlhk .gt_center {
  text-align: center;
}

#psxunkjlhk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#psxunkjlhk .gt_font_normal {
  font-weight: normal;
}

#psxunkjlhk .gt_font_bold {
  font-weight: bold;
}

#psxunkjlhk .gt_font_italic {
  font-style: italic;
}

#psxunkjlhk .gt_super {
  font-size: 65%;
}

#psxunkjlhk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#psxunkjlhk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#psxunkjlhk .gt_indent_1 {
  text-indent: 5px;
}

#psxunkjlhk .gt_indent_2 {
  text-indent: 10px;
}

#psxunkjlhk .gt_indent_3 {
  text-indent: 15px;
}

#psxunkjlhk .gt_indent_4 {
  text-indent: 20px;
}

#psxunkjlhk .gt_indent_5 {
  text-indent: 25px;
}

#psxunkjlhk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#psxunkjlhk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="table gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead><tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="protocol_vars">protocol_vars</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="exp1">exp1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="exp2">exp2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="exp4">exp4</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="protocol_vars" class="gt_row gt_left">batch</td>
<td headers="exp1" class="gt_row gt_left" style="font-weight: bold;">&lt;2e-16</td>
<td headers="exp2" class="gt_row gt_left">0.42</td>
<td headers="exp4" class="gt_row gt_left" style="font-weight: bold;">&lt;2e-16</td>
</tr>
<tr>
<td headers="protocol_vars" class="gt_row gt_left">prot1</td>
<td headers="exp1" class="gt_row gt_left">0.59</td>
<td headers="exp2" class="gt_row gt_left" style="font-weight: bold;">6.3e-16</td>
<td headers="exp4" class="gt_row gt_left">0.91</td>
</tr>
<tr>
<td headers="protocol_vars" class="gt_row gt_left">prot2</td>
<td headers="exp1" class="gt_row gt_left">0.58</td>
<td headers="exp2" class="gt_row gt_left">0.78</td>
<td headers="exp4" class="gt_row gt_left">0.55</td>
</tr>
</tbody>
</table>
</div>
<p>We see that the correct variables were detected.</p>
<p>We can see the correction for the batch effect of <code>exp1</code>
and <code>exp4</code>:</p>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
<p>We can note that there is still residual variability between batches
for <code>exp4</code>, in our case this can be explained by the
<code>season</code> effect for which we have not adjusted.</p>
<p>And the correction of <code>exp2</code> for <code>prot1</code>:</p>
<p><img src="preprocess-intro_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>Note: The correction may not be so apparent, as realistic data likely
possesses greater residual variability.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthieu Rolland.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
